
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

<div id="login_div">
        <script>
            window.onload = function(){
//                    $('#source').hide();
                $('#login_div').show();
                $("#login_button").click(function(){
                    console.log("login button clicked")
                    var username = $("#username_text_field").text();
                    var password = $("#password_text_field").text();
                    login(username, password);
                });
    $("#validate_button").click(function(){
        validate($("#source").val());
    })
            }
        </script>
        <ul>
            <li><label for="username_text_field">Username</label>
                <input type="text" name="username" id="username_text_field" placeholder="Username" required></li>
            <li><label for="password_text_field">Password</label>
                <input type="password" name="password" id="password_text_field" placeholder="Password" required></li>
            <li>
                <input type="submit" id="login_button" value="Login"></li>
        </ul>
</div>

<!--<div id="textarea_div">-->
    <!--<textarea id="textarea"></textarea>-->
    <!--<button id = "validate_button"/>-->
<!--</div>-->

<!--<div id="output"></div>-->

<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>JSON Lint</title>
    <script>
        window.onload = function () {
            document.getElementById("button").onclick = function () {
                validate(document.getElementById("source").value, function(data){
                    document.getElementById("result").innerHTML = "JSON is valid!";
                    document.getElementById("result").className = "pass";
                }, function(error){
                    document.getElementById("result").innerHTML = error;
                    document.getElementById("result").className = "fail";
                });
            };
        }
    </script>
    <style>
        body {font-family: sans-serif;}
        #result {
            padding: 1em;
        }
        .pass {
            background-color: #efe;
            color: #393;
            border: 2px solid #393;
        }
        .fail {
            background-color: #fee;
            color: #933;
            border: 2px solid #933;
        }
        textarea { width: 100%; }
    </style>
</head>
<body>
<h1>JSON Lint</h1>
  <textarea id="source" rows="20" cols="50"></textarea>
<p>
    <button id="button">Validate</button>
</p>
<h2>Results</h2>
<pre id="result"></pre>
</body>
</html>

<script language="JavaScript">
    function login(username, password, callback, error_handler){

        var request = $.ajax({
            url: "http://localhost:3000",
            type: "POST",
            data: {username: username, password: password},
            dataType: "html"
        });

        request.done(function(msg) {
            $('#source').val(msg);
            $('#source').show();
            $('#login_div').hide();
        });

        request.fail(function(jqXHR, textStatus) {
            alert( "Request failed: " + textStatus );
        });
    }

    function validate(json, callback, error_handler){
        console.log(json);

        var request = $.ajax({
            url: "http://localhost:3000/validate",
            type: "POST",
            data: {json: json},
            dataType: "html"
        });

        request.done(function(message) {
            let json = JSON.parse(message);
            console.log(message);
//            console.log(message);
            if(json["error"] == null){
                console.log("callback called!")
               callback(json.data);
            }
            else{
                console.log("Error_handler called!")
                error_handler(json.error);
            }
        });
    }
</script>